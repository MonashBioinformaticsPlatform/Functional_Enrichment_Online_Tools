# Enrichment Statistics



Enrichment statistics are based on a contingency table like so:

<!-- | Gene | ..in term | ..not in term | Total | -->
<!-- |:------------------:|----------:|--------------:|------:| -->
<!-- | ..in gene list | 30 | 270 |   300 | -->
<!-- | ..not in gene list (but in background) | 470 | 15230 | 15700 | -->
<!-- | Total |       500 | 15500 | 16000 | -->


<table border="1" style="border-collapse: collapse; width: 100%;">
  <tr>
    <th></th>
    <th>..in term</th>
    <th>..not in term</th>
    <td>Total</td>
  </tr>
  <tr>
    <th>..in gene list</th>
    <td style="background-color: #ffcccb;">30</td>
    <td style="background-color: #90ee90;">270</td>
    <td>300</td>
  </tr>
  <tr>
    <th>..not in gene list (but in background)</th>
    <td style="background-color: #add8e6;">470</td>
    <td style="background-color: #ffffe0;">15230</td>
    <td>15700</td>
  </tr>
  <tr>
    <td>Total</td>
    <td>500</td>
    <td>15500</td>
    <!-- <td>16000</td> -->
    <td style="color: orange;">16000</td> <!-- Colored text for 16000 -->
  </tr>
</table>


This is based on the 16,000 genes that were measured in your experiment. 

Note that some genes may not have been measured; these are excluded entirely from the calculations.
For example, there might have been an additional 5,000 genes (some of which could have been annotated with the term of interest), resulting in a total of *21,250 annotated genes*.

---

## <span style="color:orange;">Fisher's Exact Test</span>

Fisher's Exact Test is a statistical test used to determine if there are nonrandom associations between the proportions of two categorical variables. It calculates the exact probability of observing the given distribution of counts in a 2x2 contingency table, under the null hypothesis of no association between the variables.


> _Note:_ This is just a toy calculator for this training, it is quite limited. You can also use some online tools like [Social Science Statistics](https://www.socscistatistics.com/tests/fisher/default2.aspx) to play with.

*Formula*:
$$P = \frac{(a + b)!(c + d)!(a + c)!(b + d)!}{a!b!c!d!N!}$$

Where:

- \(a\), \(b\), \(c\), and \(d\) are the observed counts in the 2x2 contingency table.

- \(N\) is the total number of observations, \(N = a + b + c + d\).

Given this contingency table:

|            | Category 1 | Category 2 | Total |
|------------|------------|------------|-------|
| **Group 1**   | \(a\)        | \(b\)        | \(a + b\) |
| **Group 2**   | \(c\)        | \(d\)        | \(c + d\) |
| **Total**     | \(a + c\)    | \(b + d\)    | \(a + b + c + d\) |


<details>
<summary><em>R syntax</em></summary>

```{r eval=TRUE, echo=TRUE, results='hide', message=FALSE}
a = 30
b = 270
c = 470
d = 15230

data <- matrix(c(a, b, c, d), nrow = 2, byrow = TRUE)

# One-tailed test
fisher.test(data, alternative = "g") # greater or "less"
```
</details> 


## <span style="color:orange;">Hypergeometric Test</span>


Hypergeometric test calculates the probability of observing the given number of genes from a specific category (e.g., a pathway) in the gene list (differentially expressed genes) by chance. It models the situation where you draw a sample (the gene list) from a finite population (the background of all genes), and success is defined as a gene being in the category (e.g., belonging to the pathway).


> _Note:_ Here is a tool by [Stat Trek](https://stattrek.com/online-calculator/hypergeometric) to play around with the hypergeometric test.

*Formula:*
$$P(X = k) = \frac{\binom{K}{k} \binom{N - K}{n - k}}{\binom{N}{n}}$$
Where:

  - \(k\) = Number of success items in the sample (overlap).
  
  - \(n\) = Number of items in the sample (DE genes).
  
  - \(K\) = Number of success items in the population (in term).
  
  - \(N\) = Total number of items in the population (background).


The parameters in our example:
k=30; n=300; K=500; N=16000;

Where:

kâˆ’1 is the number of observed successes minus 1 (for the "at least" scenario).
lower.tail = FALSE gives the probability of getting at least k successes (right-tail).


<details>
<summary><em>R syntax</em></summary>

```{r eval=TRUE, echo=TRUE, results='hide', message=FALSE}
# Observed value
k <- a
n <- a + b
K <- a + c
N <- a + b + c + d

# (P[X >= k])
phyper(k - 1, K, N - K, n, lower.tail = FALSE)
```
</details>

---

####  {-}

## Activity

### **Challenge:** Interactive Calculator {- .challenge}

[*Link to open toy enrichment calculator*](https://bioinformatics3.erc.monash.edu/rsconnect/content/241/). 

This calculates enrichment for a single hypothetical genelist (e.g. your RNAseq differentially expressed genelist) against a single hypothetical 'term' (some set of interesting genes, e.g. synaptic signaling genes). It makes a Venn diagram and a wordy description of what is being tested.

You can adjust various factors and see their effect on the enrichment p-values. 

####  {-}

### **Questions** {- .rationale}
1. If 24 of the 300 differentially expressed genes are annotated with the 500-gene term of interest. Is it significant at p=0.05?
<details>
<summary>Show</summary>
No, corrected pval=0.087
</details>
<p>&nbsp;</p>  <!-- insert blank line -->

2. What about with a smaller background of 5000 genes (e.g. proteomic datasets)?
<details>
<summary>Show</summary>
Even less so - corrected pval=1
</details>
<p>&nbsp;</p>  <!-- insert blank line -->

3. Or, testing against a smaller database of terms; 2000 terms instead of 10000? With the original 16000 gene background.
<details>
<summary>Show</summary>
Yes, now corrected pval=0.017
</details>
<p>&nbsp;</p>  <!-- insert blank line -->

4. 19 out of 200 differentially expressed genes (9.5%), need to hit for a 500-gene term (3.1% of all genes) to be significant at (p=0.048). How many hits would be needed for a more specific 30-gene term?
<details>
<summary>Show</summary>
5 hits - 2.5% of the differentially expressed genes vs 0.19% of all genes
</details>

####  {-}